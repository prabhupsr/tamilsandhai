<!DOCTYPE html>
<html lang="en">
<head>
    <title id='Description'>In this sample is illustrated how to create custom editors for jqxGrid. The "First Name" and
        "Last Name" columns use the jqxInput widget as a cell editor. The "Products" column
        use a jqxDropDownList widget with enabled Checkboxes as an editor. The "Quantity" column's editor is jqxSlider.
    </title>
    <meta name="description"
          content="jQuery Data Grid with custom cell editors. The example shows how to create cell editors"/>
    <link rel="stylesheet" href="jqwidgets/styles/jqx.base.css" type="text/css"/>
    <script type="text/javascript" src="scripts/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxgrid.edit.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxcheckbox.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxinput.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxslider.js"></script>
    <script type="text/javascript" src="scripts/demos.js"></script>
    <script type="text/javascript" src="generatedata.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // prepare the data

            var favData = new Array();
            var roww;

            var tempfav = [];

            jQuery.ajax({
                type: "GET",
                url: "http://localhost:8080/getFavorites",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data, status, jqXHR) {
                    favData = data;
                    console.log(data);
                    console.log(favData);

                },
                error: function (jqXHR, status) {
                    // error handler
                }
            });

            for (var i = 0; i < favData.length; i++) {
                console.log("in fav ite " + i);
                //data[i] = favData[i];
                tempfav[i] = new Object();
            }


            var source =
            {
                localdata: favData,
                datatype: "array",
                updaterow: function (rowid, rowdata, commit) {
                    console.log("updaterow" + rowdata);
                    roww = rowdata;
                    // synchronize with the server - send update command
                    // call commit with parameter true if the synchronization with the server is successful
                    // and with parameter false if the synchronization failder.
                    commit(true);
                },
                datafields: [
                    {name: 'name', type: 'string'},
                    {name: 'dailyClose', type: 'string'},
                    {name: 'weeklyClose', type: 'string'}
                ]
            };

            var dataAdapter = new $.jqx.dataAdapter(source);

            // initialize jqxGrid
            $("#jqxgrid").jqxGrid(
                    {
                        width: 450,
                        source: dataAdapter,
                        editable: true,
                        selectionmode: 'singlerow',
                        editmode: 'selectedrow',
                        columns: [
                            {text: 'First Name', columntype: 'textbox', datafield: 'name', width: 80},
                            {text: 'Last Name', datafield: 'dailyClose', columntype: 'textbox', width: 80},
                            {text: 'Product', columntype: 'dropdownlist', datafield: 'weeklyClose', width: 195}
                        ]
                    });

            // events
            var rowValues = "";
            $("#jqxgrid").on('cellendedit', function (event) {
                console.log("rowwww   " + roww[0]);
                if (event.args.datafield === "name") {
                    tempfav[event.args.rowindex].name = event.args.value;
                    tempfav[event.args.rowindex].oldName = event.args.oldvalue;
                }
                else if (event.args.datafield === "dailyClose") {
                    tempfav[event.args.rowindex].dailyClose = event.args.value;
                }
                else if (event.args.datafield === "weeklyClose") {
                    tempfav[event.args.rowindex].weeklyClose = event.args.value;
                }
                console.log(JSON.stringify(tempfav[event.args.rowindex]));

                if (Object.keys(tempfav[event.args.rowindex]).length == 4) {
                    console.log("updating data");
                    jQuery.ajax({
                        type: "POST",
                        url: "http://localhost:8080/updateFav",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(tempfav[event.args.rowindex]),
                        success: function (data, status, jqXHR) {
                            console.log(data);
                        },
                        error: function (jqXHR, status) {
                            // error handler
                        }
                    });
                    tempfav[event.args.rowindex] = new Object();
                }
            });
        });
    </script>
</head>
<body class='default'>
<div id='jqxWidget'>
    <div id="jqxgrid"></div>
    <div style="font-size: 12px; font-family: Verdana, Geneva, 'DejaVu Sans', sans-serif; margin-top: 30px;">
        <div id="cellbegineditevent"></div>
        <div style="margin-top: 10px;" id="cellendeditevent"></div>
    </div>
</div>
</body>
</html>
